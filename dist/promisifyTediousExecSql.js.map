{"version":3,"sources":["../src/promisifyTediousExecSql.js"],"names":["sql","require","mapReduceSqlRows","addSqlParamsToRequest","callback","connection","resolve","reject","err","rowCount","rows","release","promisifyTediousExecSql","pool","query","params","on","acquire","request","Request","execSql","module","exports"],"mappings":";;;;;;;;AAAA,IAAMA,MAAMC,QAAQ,SAAR,CAAZ;AACA,IAAMC,mBAAmBD,6BAAzB;AACA,IAAME,wBAAwBF,kCAA9B;;AAEA,SAASG,QAAT,CAAkBC,UAAlB,EAA8BC,OAA9B,EAAuCC,MAAvC,EAA+C;AAC7C,SAAO,UAACC,GAAD,EAAMC,QAAN,EAAgBC,IAAhB,EAAyB;AAC9B,QAAIF,GAAJ,EAAS;AACPD,aAAOC,GAAP;AACD,KAFD,MAEO;AACLF,cAAQJ,iBAAiBQ,IAAjB,CAAR;AACD;;AAEDL,eAAWM,OAAX;AACD,GARD;AASD;;AAED,SAASC,uBAAT,CAAiCC,IAAjC,EAAuCC,KAAvC,EAA6D;AAAA,MAAfC,MAAe,uEAAN,IAAM;;AAC3D,SAAO,sBAAY,UAACT,OAAD,EAAUC,MAAV,EAAqB;AACtCM,SAAKG,EAAL,CAAQ,OAAR,EAAiB;AAAA,aAAOT,OAAOC,GAAP,CAAP;AAAA,KAAjB;;AAEAK,SAAKI,OAAL,CAAa,UAACT,GAAD,EAAMH,UAAN,EAAqB;AAChC,UAAIG,GAAJ,EAAS;AACPD,eAAOC,GAAP;AACAH,mBAAWM,OAAX;AACD;;AAED,UAAMO,UAAU,IAAIlB,IAAImB,OAAR,CACdL,KADc,EAEdV,SAASC,UAAT,EAAqBC,OAArB,EAA8BC,MAA9B,CAFc,CAAhB;;AAKA,UAAIQ,MAAJ,EAAY;AACVZ,8BAAsBY,MAAtB,EAA8BG,OAA9B;AACD;;AAEDb,iBAAWe,OAAX,CAAmBF,OAAnB;AACD,KAhBD;AAiBD,GApBM,CAAP;AAqBD;;AAEDG,OAAOC,OAAP,GAAiBV,uBAAjB","file":"promisifyTediousExecSql.js","sourcesContent":["const sql = require('tedious');\nconst mapReduceSqlRows = require('./mapReduceSqlRows');\nconst addSqlParamsToRequest = require('./addSqlParamsToRequest');\n\nfunction callback(connection, resolve, reject) {\n  return (err, rowCount, rows) => {\n    if (err) {\n      reject(err);\n    } else {\n      resolve(mapReduceSqlRows(rows));\n    }\n\n    connection.release();\n  };\n}\n\nfunction promisifyTediousExecSql(pool, query, params = null) {\n  return new Promise((resolve, reject) => {\n    pool.on('error', err => reject(err));\n\n    pool.acquire((err, connection) => {\n      if (err) {\n        reject(err);\n        connection.release();\n      }\n\n      const request = new sql.Request(\n        query,\n        callback(connection, resolve, reject),\n      );\n\n      if (params) {\n        addSqlParamsToRequest(params, request);\n      }\n\n      connection.execSql(request);\n    });\n  });\n}\n\nmodule.exports = promisifyTediousExecSql;\n"]}