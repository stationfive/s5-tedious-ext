{"version":3,"sources":["../src/promisifyTediousExecSql.js"],"names":["sql","require","mapReduceSqlRows","addSqlParamsToRequest","promisifyTediousExecSql","connection","query","params","resolve","reject","on","error","sqlCallback","err","rowCount","rows","results","request","Request","execSql","module","exports"],"mappings":";;;;;;;;AAAA,IAAMA,MAAMC,QAAQ,SAAR,CAAZ;AACA,IAAMC,mBAAmBD,6BAAzB;AACA,IAAME,wBAAwBF,kCAA9B;;AAEA,IAAMG,0BAA0B,SAA1BA,uBAA0B,CAACC,UAAD,EAAaC,KAAb;AAAA,MAAoBC,MAApB,uEAA6B,IAA7B;AAAA,SAC9B,sBAAa,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAChCJ,eAAWK,EAAX,CAAc,SAAd,EAAyB,UAACC,KAAD,EAAW;AAClC,UAAIA,KAAJ,EAAW;AACTF,eAAOE,KAAP;AACD;;AAED,UAAMC,cAAc,SAAdA,WAAc,CAACC,GAAD,EAAMC,QAAN,EAAgBC,IAAhB,EAAyB;AAC3C,YAAIF,GAAJ,EAAS;AACPJ,iBAAOI,GAAP;AACD,SAFD,MAEO;AACL,cAAMG,UAAUd,iBAAiBa,IAAjB,CAAhB;AACAP,kBAAQQ,OAAR;AACD;AACF,OAPD;;AASA,UAAMC,UAAU,IAAIjB,IAAIkB,OAAR,CACdZ,KADc,EAEdM,WAFc,CAAhB;;AAKA,UAAIL,MAAJ,EAAY;AACVJ,8BAAsBI,MAAtB,EAA8BU,OAA9B;AACD;;AAEDZ,iBAAWc,OAAX,CAAmBF,OAAnB;AACD,KAxBD;AAyBD,GA1BD,CAD8B;AAAA,CAAhC;;AA6BAG,OAAOC,OAAP,GAAiBjB,uBAAjB","file":"promisifyTediousExecSql.js","sourcesContent":["const sql = require('tedious');\nconst mapReduceSqlRows = require('./mapReduceSqlRows');\nconst addSqlParamsToRequest = require('./addSqlParamsToRequest');\n\nconst promisifyTediousExecSql = (connection, query, params = null) =>\n  new Promise(((resolve, reject) => {\n    connection.on('connect', (error) => {\n      if (error) {\n        reject(error);\n      }\n\n      const sqlCallback = (err, rowCount, rows) => {\n        if (err) {\n          reject(err);\n        } else {\n          const results = mapReduceSqlRows(rows);\n          resolve(results);\n        }\n      };\n\n      const request = new sql.Request(\n        query,\n        sqlCallback,\n      );\n\n      if (params) {\n        addSqlParamsToRequest(params, request);\n      }\n\n      connection.execSql(request);\n    });\n  }));\n\nmodule.exports = promisifyTediousExecSql;\n"]}